 <% html_title "#{@version.nil? ? "Product Backlog" : @version.name} - Task board" -%>

<div style="float:right; width: 80px;">
  <span>
  <%= image_tag("/plugin_assets/redmine_burndown/chart.png", :size => "20x20") %>
  </span>
  <span style="float: right; padding-top: 3px;">
  <%= link_to "Show Chart", { :controller => 'burndowns', :action => 'chart', 
                                              :project_id => @version.project_id, 
                                              :id => @version.id }, :id => 'showchart' %>
  </span>
</div>

<% content_for :header_tags do %>

  <link type="text/css" media="screen" rel="stylesheet" href="http://dl.getdropbox.com/u/2863383/js/colorbox132/example5/colorbox.css" /> 

  <%= stylesheet_link_tag 'task_board', :plugin => 'scrum_task_board' %>
  <%# stylesheet_link_tag 'colorbox', :plugin => 'scrum_task_board' %>

  <style type="text/css">
    .clearfix:after {
      content: ".";
      display: block;
      height: 0;
      clear: both;
      visibility: hidden;
      }

  .clearfix {display: inline-block;}  /* for IE/Mac */  
  </style><!-- main stylesheet ends, CC with new stylesheet below... -->

  <!--[if IE]>
  <style type="text/css">
    .clearfix {
      zoom: 1;     /* triggers hasLayout */
      display: block;     /* resets display for IE/Win */
      }  /* Only IE can see inside the conditional comment
      and read this CSS rule. Don't ever use a normal HTML
      comment inside the CC or it will close prematurely. */
  </style>
  <![endif]-->
  
  <style type="text/css" media="screen">
    #task_board tr th { width: <%= 100 / (@statuses.size + 1) %>%;}
  </style>
  
<% end %>


<h2><%= @version.nil? ? "Product Backlog" : @version.name %> Task Board</h2>

<% unless @fixed_issues.empty? %>

<div id="bdchart"> </div>

<div id="fixed_table_header"></div>

<table id="task_board" cellspacing="0">
 
  
  
  
  <thead>
    <tr>
      <% if (@stories_with_tasks.keys - [nil]).size > 0 %>
        <th>Story</th>
        <th>Subtasks</th>
      <% end -%>
         
      <% @statuses.each do |status| %>
        <th><%= status.name %></th>
      <% end -%>
    </tr>
  </thead>
  
  
  
  <tbody>
    <% @stories_with_tasks.each do |story, tasks_by_status| %>
      <% reset_cycle %>
      <tr <%= "id=\"#{dom_id(story)}_parent\"" if not story.nil?%>>
        <% if (@stories_with_tasks.keys - [nil]).size > 0 -%>
          <td <%= "style='background:#ff0000'" if story.nil? %> >
            <% if story.nil? or not @stories.include?(story)-%>&nbsp;<% else -%>
              <p class="story_subject" ><%= link_to_issue(story) %> : <%= story.subject %></p>
            <% end -%>
          </td>

          <td <%= "style='background:#ff0000'" if story.nil? %> >
            <% if story.nil? or @stories.include?(story)-%>&nbsp;<% else -%>
              <p class="story_subject" ><%= link_to_issue(story) %> : <%= story.subject %></p>
            <% end -%>
          </td>
        <% end -%>
        
        <% @statuses.each do |status| -%>
          <td id="<%= task_board_dom_id(story, status) %>" class="<%= cycle('odd', 'even') %>">
            <ul id="<%= task_board_dom_id(story, status, 'list') %>">
              <%= render :partial => 'issue', :collection => Array(tasks_by_status[status]), :locals => { :parents => @parents } %>
            </ul>
            <%= task_board_drop_receiving_element(task_board_dom_id(story, status), status) %>
          </td>
        <% end -%>
      </tr>
    <% end -%>
  </tbody>
</table>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js" type="text/javascript"></script>

  <%= javascript_include_tag 'jquery.jqplot.js', :plugin => 'redmine_burndown' %>
  <%= javascript_include_tag 'plugins/jqplot.canvasTextRenderer.min.js', :plugin => 'redmine_burndown' %>
  <%= javascript_include_tag 'plugins/jqplot.canvasAxisLabelRenderer.min.js', :plugin => 'redmine_burndown' %>
  <%= javascript_include_tag 'plugins/jqplot.cursor.min.js', :plugin => 'redmine_burndown' %>
  <%= javascript_include_tag 'plugins/jqplot.dateAxisRenderer.min.js', :plugin => 'redmine_burndown' %>
  <%= javascript_include_tag 'plugins/jqplot.highlighter.min.js', :plugin => 'redmine_burndown' %>
  <%= javascript_include_tag 'chart.js', :plugin => 'redmine_burndown' %>

  <%= javascript_include_tag  'jquery.colorbox-min.js', :plugin => 'scrum_task_board' %>
  
  <%= javascript_include_tag  'fixedtableheader', :plugin => 'scrum_task_board' %>

  <script type="text/javascript">
    jQuery("#showchart").colorbox({opacity: 0.7, onComplete:function(){
        var nil = null; // to translate nil to null
        plot_chart(<%= BurndownChart.new(@version).data_and_dates.inspect if !@version.effective_date.nil? %>);
    }});
  </script>

<% else %>
<h3>There are no issues targeted for this version.</h3>
<% end %>


